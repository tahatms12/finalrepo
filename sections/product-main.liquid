{%- comment -%}
  Product schema incl. price, availability, review aggregate
{%- endcomment -%}
{% assign brand_name = 'Auto Enhance Hub' %}
{% assign brampton_city = 'Brampton' %}
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Product",
  "name":"{{ product.title }}",
  "image":[{% for img in product.images %}"{{ img | img_url: '800x' }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
  "description":"{{ product.description | strip_html | truncate: 160 }}",
  "sku":"{{ product.selected_or_first_available_variant.sku }}",
  "mpn":"{{ product.id }}",
  "brand":{"@type":"Brand","name":"{{ brand_name }}"},
  "offers":{
    "@type":"Offer",
    "url":"{{ shop.url }}{{ product.url }}",
    "priceCurrency":"CAD",
    "price":"{{ product.price | money_without_currency }}",
    "availability":"https://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}"
  }{% if product.metafields.reviews.rating_count > 0 %},
  "aggregateRating":{
    "@type":"AggregateRating",
    "ratingValue":"{{ product.metafields.reviews.rating_value }}",
    "reviewCount":"{{ product.metafields.reviews.rating_count }}"
  }{% endif %}
}
</script>
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"{{ shop.url }}"},
    {"@type":"ListItem","position":2,"name":"{{ product.title }}","item":"{{ shop.url }}{{ product.url }}"}
  ]
}
</script>
<div class="container mx-auto p-10">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div>
      {% if product.featured_image %}
        <img src="{{ product.featured_image | image_url: 'large' }}"
         alt="{{ product.title }} {{ brampton_city }} auto parts"
         width="{{ product.featured_image.width }}"
         height="{{ product.featured_image.height }}"
         loading="lazy"
         class="w-full h-96 object-cover mb-4"/>
      {% else %}
        <div class="bg-gray-200 h-96 mb-4"></div>
      {% endif %}
    </div>
    <div>
      <p class="text-sm text-gray-500">{{ product.sku }}</p>
      <h1 class="text-3xl font-bold mb-4">{{ product.title }}</h1>
      <p class="text-2xl font-bold mb-4">{{ product.price | money }}</p>

      {% form 'product', product %}
        <select name="id" id="product-select-{{ product.id }}" class="hidden">
          {% for variant in product.variants %}
            <option
              {% if variant == product.selected_or_first_available_variant %}
                selected="selected"
              {% endif %}
              {% if variant.available == false %}
                disabled="disabled"
              {% endif %}
              value="{{ variant.id }}"
            >
              {{ variant.title }}
            </option>
          {% endfor %}
        </select>

        <button type="submit" name="add" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full"
          {% if product.selected_or_first_available_variant.available == false %}
            disabled="disabled"
          {% endif %}
        >
          {% if product.selected_or_first_available_variant.available %}
            {{ section.settings.add_to_cart_text }}
          {% else %}
            {{ section.settings.sold_out_text }}
          {% endif %}
        </button>
      {% endform %}

      <div class="mb-4">
        <span class="bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded">{{ section.settings.badge_text }}</span>
      </div>
      <div class="mb-4">
        <h2 class="font-bold mb-2">{{ section.settings.specs_title }}</h2>
        {% assign alt_tag = '<img loading="lazy" alt="' | append: product.title | append: ' ' | append: brampton_city | append: ' auto parts"' %}
        <div class="prose">{{ product.description | replace: '<img', alt_tag }}</div>
      </div>
      <div class="mb-4">
        <h2 class="font-bold mb-2">{{ section.settings.compatibility_title }}</h2>
        <p>{{ section.settings.compatibility_text }}</p>
      </div>
      <div class="mb-4">
        <h2 class="font-bold mb-2">{{ section.settings.condition_title }}</h2>
        <p>{{ section.settings.condition_text }}</p>
      </div>
      <div class="mb-4">
        <h2 class="font-bold mb-2">{{ section.settings.shipping_title }}</h2>
        <p>{{ section.settings.shipping_text }}</p>
      </div>
      <div class="mb-4">
        <h2 class="font-bold mb-2">{{ section.settings.pickup_title }}</h2>
        <p>{{ section.settings.pickup_text }}</p>
      </div>
      <div class="mb-4">
        <h2 class="font-bold mb-2">{{ section.settings.return_policy_title }}</h2>
        <p>{{ section.settings.return_policy_text }}</p>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Product Main",
  "settings": [
    {
      "type": "text",
      "id": "add_to_cart_text",
      "label": "Add to Cart Button Text",
      "default": "Add to Cart"
    },
    {
      "type": "text",
      "id": "sold_out_text",
      "label": "Sold Out Button Text",
      "default": "Sold Out"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge Text",
      "default": "OEM/Aftermarket Badge (Placeholder)"
    },
    {
      "type": "text",
      "id": "specs_title",
      "label": "Specifications Title",
      "default": "Part Specifications"
    },
    {
      "type": "text",
      "id": "compatibility_title",
      "label": "Compatibility Title",
      "default": "Vehicle Compatibility (Placeholder)"
    },
    {
      "type": "text",
      "id": "compatibility_text",
      "label": "Compatibility Text",
      "default": "Compatible with Make Model Year"
    },
    {
      "type": "text",
      "id": "condition_title",
      "label": "Condition Title",
      "default": "Condition Details (Placeholder)"
    },
    {
      "type": "text",
      "id": "condition_text",
      "label": "Condition Text",
      "default": "New/Used"
    },
    {
      "type": "text",
      "id": "shipping_title",
      "label": "Shipping Title",
      "default": "Shipping Options (Placeholder)"
    },
    {
      "type": "text",
      "id": "shipping_text",
      "label": "Shipping Text",
      "default": "Worldwide Shipping"
    },
    {
      "type": "text",
      "id": "pickup_title",
      "label": "Local Pickup Title",
      "default": "Local Pickup Availability (Placeholder)"
    },
    {
      "type": "text",
      "id": "pickup_text",
      "label": "Local Pickup Text",
      "default": "Available at 5 locations"
    },
    {
      "type": "text",
      "id": "return_policy_title",
      "label": "Return Policy Title",
      "default": "Return Policy (Placeholder)"
    },
    {
      "type": "text",
      "id": "return_policy_text",
      "label": "Return Policy Text",
      "default": "30-Day Return Policy"
    }
  ]
}
{% endschema %}
