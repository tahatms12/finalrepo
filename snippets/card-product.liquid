{%- liquid
  assign ratio = 1
  if card_product.featured_media and media_aspect_ratio == 'portrait'
    assign ratio = 0.8
  elsif card_product.featured_media and media_aspect_ratio == 'adapt'
    assign ratio = card_product.featured_media.aspect_ratio
  endif
  if ratio == 0 or ratio == null
    assign ratio = 1
  endif
-%}

<div class="card-wrapper underline-links-hover">
  <div class="card card--media" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
    <div class="card__inner ratio" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
      {%- if card_product.featured_media -%}
        <div class="card__media">
          <div class="media media--transparent media--hover-effect">
            <img
              srcset="{%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                      {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                      {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                      {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                      {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                      {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                      {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w"
              src="{{ card_product.featured_media | image_url: width: 533 }}"
              sizes="(min-width: 1200px) 300px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
              alt="{{ card_product.featured_media.alt | escape }}"
              class="motion-reduce"
              {% unless lazy_load == false %}loading="lazy"{% endunless %}
              width="{{ card_product.featured_media.width }}"
              height="{{ card_product.featured_media.height }}"
            >

            {%- if card_product.media[1] != null and show_secondary_image -%}
              <img
                srcset="{%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                        {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                        {%- if card_product.media[1].width >= 533 -%}{{ card_product.media[1] | image_url: width: 533 }} 533w,{%- endif -%}
                        {%- if card_product.media[1].width >= 720 -%}{{ card_product.media[1] | image_url: width: 720 }} 720w,{%- endif -%}
                        {%- if card_product.media[1].width >= 940 -%}{{ card_product.media[1] | image_url: width: 940 }} 940w,{%- endif -%}
                        {%- if card_product.media[1].width >= 1066 -%}{{ card_product.media[1] | image_url: width: 1066 }} 1066w,{%- endif -%}
                        {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w"
                src="{{ card_product.media[1] | image_url: width: 533 }}"
                sizes="(min-width: 1200px) 300px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                alt=""
                class="motion-reduce"
                loading="lazy"
                width="{{ card_product.media[1].width }}"
                height="{{ card_product.media[1].height }}"
              >
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}
      
      <div class="card__content">
        <div class="card__information">
          <h3 class="card__heading">
            <a href="{{ card_product.url }}" id="StandardCardNoMediaLink-{{ card_product.id }}" class="full-unstyled-link" aria-labelledby="StandardCardNoMediaLink-{{ card_product.id }} NoMediaStandardBadge-{{ card_product.id }}">
              {{ card_product.title | escape }}
            </a>
          </h3>
        </div>
        
        <div class="card__badge">
          {%- if card_product.available == false -%}
            <span id="NoMediaStandardBadge-{{ card_product.id }}" class="badge badge--bottom-left">
              Sold out
            </span>
          {%- elsif card_product.compare_at_price > card_product.price and card_product.available -%}
            <span id="NoMediaStandardBadge-{{ card_product.id }}" class="badge badge--bottom-left">
              Sale
            </span>
          {%- endif -%}
        </div>
      </div>
    </div>
    
    <div class="card__content">
      <div class="card__information">
        <h3 class="card__heading h5">
          <a href="{{ card_product.url }}" id="CardLink-{{ card_product.id }}" class="full-unstyled-link" aria-labelledby="CardLink-{{ card_product.id }} Badge-{{ card_product.id }}">
            {{ card_product.title | escape }}
          </a>
        </h3>
        
        <div class="card-information">
          {%- if show_vendor -%}
            <span class="visually-hidden">Vendor</span>
            <div class="caption-with-letter-spacing light">{{ card_product.vendor }}</div>
          {%- endif -%}

          {%- if show_rating and card_product.metafields.reviews.rating.value != blank -%}
            {% liquid
              assign rating_decimal = 0
              assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
              if decimal >= 0.3 and decimal <= 0.7
                assign rating_decimal = 0.5
              elsif decimal > 0.7
                assign rating_decimal = 1
              endif
            %}
            <div class="rating" role="img" aria-label="Rating: {{ card_product.metafields.reviews.rating.value }} out of {{ card_product.metafields.reviews.rating.value.scale_max }}">
              <span aria-hidden="true" class="rating-star" style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"></span>
            </div>
            <p class="rating-text caption">
              <span aria-hidden="true">{{ card_product.metafields.reviews.rating.value }} / {{ card_product.metafields.reviews.rating.value.scale_max }}</span>
            </p>
            <p class="rating-count caption">
              <span aria-hidden="true">({{ card_product.metafields.reviews.rating_count }})</span>
              <span class="visually-hidden">{{ card_product.metafields.reviews.rating_count }} total reviews</span>
            </p>
          {%- endif -%}

          <span class="price">
            {%- if card_product.price_varies -%}
              <span class="price-item price-item--regular">
                From {{ card_product.price_min | money }}
              </span>
            {%- else -%}
              <span class="price-item price-item--regular">
                {{ card_product.price | money }}
              </span>
            {%- endif -%}
            {%- if card_product.compare_at_price > card_product.price -%}
              <span class="price-item price-item--sale">
                {{ card_product.compare_at_price | money }}
              </span>
            {%- endif -%}
          </span>
        </div>
      </div>
      
      <div class="card__badge">
        {%- if card_product.available == false -%}
          <span id="Badge-{{ card_product.id }}" class="badge badge--bottom-left">
            Sold out
          </span>
        {%- elsif card_product.compare_at_price > card_product.price and card_product.available -%}
          <span id="Badge-{{ card_product.id }}" class="badge badge--bottom-left">
            Sale
          </span>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

<style>
  .card-wrapper {
    color: inherit;
    height: 100%;
    position: relative;
    text-decoration: none;
  }

  .card {
    position: relative;
    box-sizing: border-box;
    border-radius: var(--radius-md);
    border: 1px solid rgba(var(--color-foreground), 0.04);
    box-shadow: var(--shadow-card);
    transition: var(--transition-base);
    height: 100%;
  }

  .card:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-2px);
  }

  .card__inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: left;
    border-radius: inherit;
    overflow: hidden;
  }

  .card__media {
    overflow: hidden;
    position: relative;
    width: 100%;
  }

  .card__media .media {
    bottom: 0;
    position: absolute;
    top: 0;
  }

  .card__media .media img {
    height: 100%;
    object-fit: cover;
    object-position: center center;
    width: 100%;
  }

  .card__content {
    position: relative;
    padding: var(--spacing-md);
  }

  .card__information {
    padding: 0;
  }

  .card__heading {
    margin: 0 0 var(--spacing-xs) 0;
  }

  .card__heading a {
    color: var(--color-text);
    text-decoration: none;
  }

  .card__heading a:hover {
    color: var(--color-accent);
  }

  .card-information {
    text-align: left;
  }

  .price {
    display: flex;
    flex-wrap: wrap;
    font-size: 1.1rem;
    font-weight: var(--font-weight-semibold);
  }

  .price-item--regular {
    color: var(--color-text);
  }

  .price-item--sale {
    color: var(--color-text-light);
    text-decoration: line-through;
    margin-left: var(--spacing-xs);
  }

  .badge {
    background-color: var(--color-accent);
    border-radius: var(--radius-sm);
    color: white;
    display: inline-block;
    font-size: 0.75rem;
    font-weight: var(--font-weight-medium);
    line-height: 1;
    padding: 0.6rem 1rem;
    position: absolute;
    text-align: center;
    text-transform: uppercase;
    word-break: break-word;
    z-index: 1;
  }

  .badge--bottom-left {
    bottom: var(--spacing-md);
    left: var(--spacing-md);
  }

  .full-unstyled-link {
    text-decoration: none;
    color: currentColor;
    display: block;
  }

  .full-unstyled-link:hover {
    color: currentColor;
  }

  .visually-hidden {
    position: absolute !important;
    overflow: hidden;
    width: 1px;
    height: 1px;
    margin: -1px;
    padding: 0;
    border: 0;
    clip: rect(0 0 0 0);
    word-wrap: normal !important;
  }

  .ratio {
    display: block;
    position: relative;
  }

  .ratio::before {
    content: '';
    width: 1px;
    margin-left: -1px;
    float: left;
    height: 0;
    padding-top: var(--ratio-percent);
  }

  .ratio::after {
    content: '';
    display: table;
    clear: both;
  }

  .media {
    display: block;
    position: relative;
  }

  .media--transparent {
    background-color: transparent;
  }

  .media--hover-effect > img + img {
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    transition: opacity 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .card:hover .media--hover-effect > img + img {
    opacity: 1;
  }

  .motion-reduce {
    transition: none !important;
  }

  @media (prefers-reduced-motion: reduce) {
    .motion-reduce {
      transition: none !important;
    }
  }
</style>